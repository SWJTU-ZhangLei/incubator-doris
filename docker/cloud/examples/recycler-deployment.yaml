apiVersion: apps/v1      
kind: Deployment                                                                                               
metadata:               
  name: recycler-deployment 
  labels:
    app: recycler

spec:
  replicas: 1
  selector:
    matchLabels:
      app: recycler

  template:
    metadata:
      labels:
        app: recycler
    spec:
      containers:
      - name: recycler
        image: selectdb-recycler:latest
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - name: config 
          mountPath: /opt/selectdb/recycler/conf
          readOnly: true
      volumes:                                         
      - name: config
        projected:
          sources:
          - configMap:
              name: recycler-configmap
          - configMap:
              name: test-cluster-config
              items:
              - key: "cluster-file"
                path: "fdb.cluster"
                           
---          
apiVersion: v1       
kind: ConfigMap
metadata:        
  name: recycler-configmap
data:                                                  
  selectdb_cloud.conf: |                               
    brpc_listen_port = 5000 
    brpc_num_threads = -1
    fdb_cluster_file_path = ./conf/fdb.cluster
    http_token = greedisgood9999

    # // doris txn config
    label_keep_max_second = 259200
    expired_txn_scan_key_nums = 1000

    # // logging
    log_dir = ./log/
    # info warn error
    log_level = info
    log_size_mb = 1024
    log_filenum_quota = 10
    log_immediate_flush = true

    # // recycler config
    recycle_interval_seconds = 3600
    retention_seconds = 259200
    recycle_concurrency = 16

    # //max stage num
    max_num_stages = 40

